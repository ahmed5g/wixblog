<div class="dashboard-container">
  <header class="dashboard-header">
    <h1>Dashboard</h1>
    <div class="user-info">
      <img [src]="user?.profilePicture || 'assets/default-avatar.png'"
           alt="Profile" class="avatar">
      <span>Welcome, {{user?.name}}</span>
      <button (click)="logout()" class="logout-btn">Logout</button>
    </div>
  </header>

  <nav class="dashboard-nav">
    <a routerLink="/dashboard" routerLinkActive="active">Home</a>
    <a *ngIf="isAdmin" routerLink="/admin" routerLinkActive="active">Admin Panel</a>
    <a routerLink="/posts" routerLinkActive="active">My Posts</a>
  </nav>

  <main class="dashboard-content">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      <p>Loading...</p>
    </div>

    <!-- Content when loaded -->
    <div *ngIf="!isLoading && user">
      <div class="welcome-card">
        <h2>Hello, {{user.name}}!</h2>
        <p><strong>Email:</strong> {{user.email}}</p>
        <p><strong>Role:</strong> {{user.role}}</p>
        <p><strong>Member since:</strong> {{user.createdAt | date}}</p>
      </div>

      <div class="features">
        <div class="feature-card">
          <h3>Create Blog Post</h3>
          <p>Start writing your new blog post</p>
          <button>New Post</button>
        </div>

        <div class="feature-card">
          <h3>My Posts</h3>
          <p>View and manage your existing posts</p>
          <button routerLink="/posts">View Posts</button>
        </div>

        <!-- Admin Features -->
        <div *ngIf="isAdmin" class="feature-card admin-card">
          <h3>Admin Panel</h3>
          <p>Manage users and site settings</p>
          <button routerLink="/admin">Admin Dashboard</button>
        </div>

        <!-- Quick Admin Stats -->
        <div *ngIf="isAdmin" class="feature-card admin-stats">
          <h3>Quick Stats</h3>
          <p>Total Users: {{allUsers.length}}</p>
          <p>Admins: {{adminCount}}</p> <!-- ✅ Use computed property -->
          <p>Regular Users: {{userCount}}</p> <!-- ✅ Use computed property -->
        </div>
      </div>

      <!-- Quick User Management (Optional - for dashboard) -->
      <div *ngIf="isAdmin && allUsers.length > 0" class="user-management-preview">
        <h3>Recent Users</h3>
        <div class="users-list">
          <!-- ✅ Use computed property for recent users -->
          <div *ngFor="let userItem of recentUsers" class="user-item">
            <img [src]="userItem.profilePicture || 'assets/default-avatar.png'"
                 alt="{{userItem.name}}" class="user-avatar">
            <div class="user-details">
              <strong>{{userItem.name}}</strong>
              <span class="user-email">{{userItem.email}}</span>
              <span [class]="'role-badge ' + (userItem.role === 'ROLE_ADMIN' ? 'admin' : 'user')">
                {{userItem.role === 'ROLE_ADMIN' ? 'Admin' : 'User'}}
              </span>
            </div>
            <div class="user-actions">
              <button *ngIf="userItem.role === 'ROLE_USER'"
                      (click)="promoteUser(userItem.id)"
                      class="btn-promote">
                Make Admin
              </button>
              <button *ngIf="userItem.role === 'ROLE_ADMIN' && userItem.id !== user?.id"
                      (click)="demoteUser(userItem.id)"
                      class="btn-demote">
                Make User
              </button>
            </div>
          </div>
        </div>
        <button routerLink="/admin" class="view-all-btn">View All Users</button>
      </div>
    </div>
  </main>
</div>
